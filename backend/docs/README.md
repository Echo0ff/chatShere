# ğŸš€ ChatSphere - ä¼ä¸šçº§å®æ—¶èŠå¤©ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº FastAPI çš„ç°ä»£åŒ–ä¼ä¸šçº§èŠå¤©åº”ç”¨ï¼Œé›†æˆäº† JWT è®¤è¯ã€OAuth2 ç™»å½•ã€WebSocket å®æ—¶é€šä¿¡ã€Redis ç¼“å­˜ã€PostgreSQL æ•°æ®åº“å’Œè‡ªå®šä¹‰ä¸­é—´ä»¶æŠ€æœ¯ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ” è®¤è¯ç³»ç»Ÿ
- **JWT Token è®¤è¯**ï¼šå®‰å…¨çš„è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œæœºåˆ¶
- **OAuth2 é›†æˆ**ï¼šæ”¯æŒ Google å’Œ GitHub ç¬¬ä¸‰æ–¹ç™»å½•
- **ç”¨æˆ·ç®¡ç†**ï¼šæ³¨å†Œã€ç™»å½•ã€èµ„æ–™æ›´æ–°ã€å¯†ç ä¿®æ”¹
- **Token ç®¡ç†**ï¼šæ’¤é”€ã€é»‘åå•ã€è‡ªåŠ¨è¿‡æœŸ

### ğŸ’¬ èŠå¤©åŠŸèƒ½
- **å®æ—¶é€šä¿¡**ï¼šåŸºäº WebSocket çš„å³æ—¶æ¶ˆæ¯ä¼ è¾“
- **å¤šç§èŠå¤©ç±»å‹**ï¼šç§èŠã€ç¾¤èŠã€å…¬å¼€æˆ¿é—´
- **æ¶ˆæ¯çŠ¶æ€**ï¼šå·²å‘é€ã€å·²é€è¾¾ã€å·²è¯»çŠ¶æ€è·Ÿè¸ª
- **åœ¨çº¿çŠ¶æ€**ï¼šå®æ—¶æ˜¾ç¤ºç”¨æˆ·åœ¨çº¿/ç¦»çº¿çŠ¶æ€

### ğŸ—„ï¸ æ•°æ®æŒä¹…åŒ–
- **PostgreSQL**ï¼šå…³ç³»å‹æ•°æ®åº“å­˜å‚¨ç”¨æˆ·ã€æ¶ˆæ¯ã€ä¼šè¯æ•°æ®
- **Redis ç¼“å­˜**ï¼šé«˜æ€§èƒ½ç¼“å­˜ç”¨æˆ·ä¼šè¯ã€åœ¨çº¿çŠ¶æ€ã€æ¶ˆæ¯ç¼“å­˜
- **äº‹åŠ¡æ”¯æŒ**ï¼šè‡ªåŠ¨äº‹åŠ¡ç®¡ç†ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### ğŸ›¡ï¸ å®‰å…¨ä¸æ€§èƒ½
- **è‡ªå®šä¹‰ä¸­é—´ä»¶**ï¼šé€Ÿç‡é™åˆ¶ã€å®‰å…¨å¤´éƒ¨ã€è¯·æ±‚æ—¥å¿—ã€é”™è¯¯å¤„ç†
- **ç”¨æˆ·æ´»åŠ¨è·Ÿè¸ª**ï¼šç›‘æ§ç”¨æˆ·è¡Œä¸ºå’Œè¿æ¥çŠ¶æ€
- **ç¼“å­˜ç­–ç•¥**ï¼šæ™ºèƒ½ç¼“å­˜æå‡åº”ç”¨æ€§èƒ½

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web Client    â”‚    â”‚   Mobile App    â”‚    â”‚  Third Party    â”‚
â”‚   (React/Vue)   â”‚    â”‚   (Flutter)     â”‚    â”‚   Integration   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚             Nginx (Optional)            â”‚
              â”‚          Load Balancer/Proxy            â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              FastAPI App                â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚   REST API  â”‚   WebSocket API     â”‚  â”‚
              â”‚  â”‚             â”‚                     â”‚  â”‚
              â”‚  â”‚ JWT/OAuth2  â”‚  Real-time Chat     â”‚  â”‚
              â”‚  â”‚ CRUD Ops    â”‚  Connection Mgmt    â”‚  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
              â”‚  â”‚          Middleware Stack           â”‚ â”‚
              â”‚  â”‚ Rate Limit â”‚ Security â”‚ Logging    â”‚ â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   PostgreSQL    â”‚    â”‚    Redis     â”‚
              â”‚   Primary DB    â”‚    â”‚    Cache     â”‚
              â”‚                 â”‚    â”‚              â”‚
              â”‚ â€¢ Users         â”‚    â”‚ â€¢ Sessions   â”‚
              â”‚ â€¢ Messages      â”‚    â”‚ â€¢ Online     â”‚
              â”‚ â€¢ Rooms/Groups  â”‚    â”‚ â€¢ Rate Limit â”‚
              â”‚ â€¢ Read Status   â”‚    â”‚ â€¢ Messages   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ main.py                 # ğŸš€ åº”ç”¨å…¥å£ç‚¹
â”œâ”€â”€ config.py              # âš™ï¸ åº”ç”¨é…ç½®
â”œâ”€â”€ models.py              # ğŸ“Š æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ database.py            # ğŸ—„ï¸ æ•°æ®åº“è¿æ¥ç®¡ç†
â”œâ”€â”€ cache.py               # ğŸš€ Redis ç¼“å­˜ç®¡ç†
â”œâ”€â”€ auth.py                # ğŸ” JWT/OAuth2 è®¤è¯
â”œâ”€â”€ middleware.py          # ğŸ›¡ï¸ è‡ªå®šä¹‰ä¸­é—´ä»¶
â”œâ”€â”€ websocket_manager.py   # ğŸ’¬ WebSocket è¿æ¥ç®¡ç†
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ auth.py           # ğŸ”‘ è®¤è¯ç›¸å…³è·¯ç”±
â”œâ”€â”€ pyproject.toml         # ğŸ“¦ é¡¹ç›®ä¾èµ–
â”œâ”€â”€ docker-compose.yml     # ğŸ³ Docker ç¼–æ’
â”œâ”€â”€ Dockerfile            # ğŸ³ Docker é•œåƒ
â””â”€â”€ README.md             # ğŸ“– é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.11+
- PostgreSQL 12+
- Redis 6+
- Docker & Docker Compose (å¯é€‰)

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd chatsphere/backend
```

### 2. é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒé…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
vim .env
```

### 3. æ–¹å¼ä¸€ï¼šæœ¬åœ°å¼€å‘
```bash
# å®‰è£…ä¾èµ–
pip install -e .

# å¯åŠ¨ PostgreSQL å’Œ Redis (macOS)
brew services start postgresql
brew services start redis

# è¿è¡Œåº”ç”¨
uvicorn main:app --reload
```

### 4. æ–¹å¼äºŒï¼šDocker éƒ¨ç½²
```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f chatsphere
```

## ğŸ“¡ API æ¥å£

### è®¤è¯æ¥å£
```http
POST /api/v1/auth/register      # ç”¨æˆ·æ³¨å†Œ
POST /api/v1/auth/login         # ç”¨æˆ·ç™»å½•
POST /api/v1/auth/oauth2/login  # OAuth2 ç™»å½•
POST /api/v1/auth/token/refresh # åˆ·æ–° Token
POST /api/v1/auth/logout        # ç”¨æˆ·ç™»å‡º
GET  /api/v1/auth/me           # è·å–ç”¨æˆ·ä¿¡æ¯
PUT  /api/v1/auth/me           # æ›´æ–°ç”¨æˆ·èµ„æ–™
```

### èŠå¤©æ¥å£
```http
GET  /api/v1/conversations           # è·å–ä¼šè¯åˆ—è¡¨
GET  /api/v1/messages/{type}/{id}    # è·å–èŠå¤©è®°å½•
GET  /api/v1/users/online           # è·å–åœ¨çº¿ç”¨æˆ·
GET  /api/v1/rooms                  # è·å–å…¬å¼€æˆ¿é—´
```

### WebSocket è¿æ¥
```javascript
// è¿æ¥ WebSocket
const ws = new WebSocket('ws://localhost:8000/ws?token=YOUR_JWT_TOKEN');

// å‘é€æ¶ˆæ¯
ws.send(JSON.stringify({
    type: 'chat',
    content: 'Hello, World!',
    room_id: 'general'
}));
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. è®¤è¯ç³»ç»Ÿ (`auth.py`)
```python
# JWT Token ç”Ÿæˆå’ŒéªŒè¯
auth_manager = AuthManager()
token = auth_manager.create_access_token(user_data)

# OAuth2 ç¬¬ä¸‰æ–¹ç™»å½•
oauth_manager = OAuth2Manager()
user_info = await oauth_manager.get_google_user_info(access_token)
```

### 2. WebSocket ç®¡ç† (`websocket_manager.py`)
```python
# è¿æ¥ç®¡ç†
connection_manager = ConnectionManager()
await connection_manager.connect(websocket, user, session)

# æ¶ˆæ¯å¹¿æ’­
await connection_manager.handle_message(user_id, message_data, session)
```

### 3. ç¼“å­˜ç³»ç»Ÿ (`cache.py`)
```python
# ç”¨æˆ·ä¼šè¯ç¼“å­˜
await cache_manager.cache_user_session(user_id, session_data)

# åœ¨çº¿çŠ¶æ€ç®¡ç†
await cache_manager.cache_user_online_status(user_id, True)
```

### 4. è‡ªå®šä¹‰ä¸­é—´ä»¶ (`middleware.py`)
```python
# é€Ÿç‡é™åˆ¶
app.add_middleware(RateLimitMiddleware, requests_per_minute=60)

# å®‰å…¨å¤´éƒ¨
app.add_middleware(SecurityHeadersMiddleware)

# è¯·æ±‚æ—¥å¿—
app.add_middleware(RequestLoggingMiddleware)
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **JWT é»‘åå•**ï¼šæ”¯æŒ Token æ’¤é”€å’Œé»‘åå•æœºåˆ¶
- **é€Ÿç‡é™åˆ¶**ï¼šé˜²æ­¢ API æ»¥ç”¨å’Œ DDoS æ”»å‡»
- **CORS é…ç½®**ï¼šç²¾ç¡®æ§åˆ¶è·¨åŸŸè®¿é—®æƒé™
- **å®‰å…¨å¤´éƒ¨**ï¼šè‡ªåŠ¨æ·»åŠ å®‰å…¨ç›¸å…³ HTTP å¤´éƒ¨
- **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨ bcrypt å®‰å…¨å­˜å‚¨ç”¨æˆ·å¯†ç 
- **è¾“å…¥éªŒè¯**ï¼šPydantic æ¨¡å‹éªŒè¯æ‰€æœ‰è¾“å…¥æ•°æ®

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

- **è¿æ¥æ± **ï¼šæ•°æ®åº“å’Œ Redis è¿æ¥æ± ç®¡ç†
- **å¼‚æ­¥å¤„ç†**ï¼šå…¨å¼‚æ­¥æ¶æ„æå‡å¹¶å‘æ€§èƒ½
- **æ™ºèƒ½ç¼“å­˜**ï¼šå¤šå±‚ç¼“å­˜ç­–ç•¥å‡å°‘æ•°æ®åº“å‹åŠ›
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRedis å®ç°é«˜æ•ˆæ¶ˆæ¯ä¼ é€’
- **WebSocket ä¼˜åŒ–**ï¼šè¿æ¥å¤ç”¨å’Œè‡ªåŠ¨é‡è¿

## ğŸ” ç›‘æ§ä¸æ—¥å¿—

- **ç»“æ„åŒ–æ—¥å¿—**ï¼šè¯¦ç»†çš„è¯·æ±‚å’Œé”™è¯¯æ—¥å¿—è®°å½•
- **å¥åº·æ£€æŸ¥**ï¼šå†…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹
- **æ€§èƒ½ç›‘æ§**ï¼šè¯·æ±‚å¤„ç†æ—¶é—´å’Œèµ„æºä½¿ç”¨ç›‘æ§
- **ç”¨æˆ·æ´»åŠ¨è·Ÿè¸ª**ï¼šå®æ—¶ç”¨æˆ·è¡Œä¸ºåˆ†æ

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
pytest

# è¦†ç›–ç‡æµ‹è¯•
pytest --cov=.

# å‹åŠ›æµ‹è¯•
locust -f tests/load_test.py
```

## ğŸš€ éƒ¨ç½²

### ç”Ÿäº§ç¯å¢ƒå»ºè®®
1. ä½¿ç”¨ HTTPS/WSS åŠ å¯†ä¼ è¾“
2. é…ç½® Nginx åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡
3. ä½¿ç”¨ PostgreSQL ä¸»ä»å¤åˆ¶
4. Redis é›†ç¾¤éƒ¨ç½²
5. å®¹å™¨ç¼–æ’ (Kubernetes)
6. æ—¥å¿—èšåˆå’Œç›‘æ§ (ELK Stack)

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹
SECRET_KEY=your-super-secure-secret-key
POSTGRES_PASSWORD=strong-database-password
REDIS_PASSWORD=strong-redis-password

# OAuth2 é…ç½®
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„ Python Web æ¡†æ¶
- [SQLAlchemy](https://sqlalchemy.org/) - å¼ºå¤§çš„ ORM å·¥å…·
- [Redis](https://redis.io/) - é«˜æ€§èƒ½å†…å­˜æ•°æ®åº“
- [PostgreSQL](https://postgresql.org/) - å¯é çš„å…³ç³»å‹æ•°æ®åº“

---

**ğŸ‰ ChatSphere - è®©æ²Ÿé€šæ›´ç®€å•ï¼Œè®©è¿æ¥æ›´ç´§å¯†ï¼**
